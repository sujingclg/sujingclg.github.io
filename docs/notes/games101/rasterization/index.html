<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="光栅化 #  Rasterization
  离散化三角形 #  Triangles
   What is a screen?
 An array of pixels Size of the array: resolution A typical kind of raster display    Raster == screen in German（屏幕的德语词汇）
 Rasterize == drawing onto the screen    Pixel (FYI, short for “picture element”)
 For now: A pixel is a little square with uniform color Color is a mixture of (red, green, blue)    光栅化步骤 #    从变换空间[-1,1]^3^映射到到屏幕空间。首先忽略z方向，使用视口变换将xy空间映射到屏幕。"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="光栅化"><meta property="og:description" content="光栅化 #  Rasterization
  离散化三角形 #  Triangles
   What is a screen?
 An array of pixels Size of the array: resolution A typical kind of raster display    Raster == screen in German（屏幕的德语词汇）
 Rasterize == drawing onto the screen    Pixel (FYI, short for “picture element”)
 For now: A pixel is a little square with uniform color Color is a mixture of (red, green, blue)    光栅化步骤 #    从变换空间[-1,1]^3^映射到到屏幕空间。首先忽略z方向，使用视口变换将xy空间映射到屏幕。"><meta property="og:type" content="article"><meta property="og:url" content="https://sujingclg.github.io/docs/notes/games101/rasterization/"><meta property="article:section" content="docs"><title>光栅化 | 计算机图形学基础</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.ba21324315b869c3638ea99918c07b1e84ec935ebd281e00189aec9bd6c24c47.js integrity="sha256-uiEyQxW4acNjjqmZGMB7HoTsk169KB4AGJrsm9bCTEc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>计算机图形学基础</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-903d3e7635db560eef69c6ad03432b92 class=toggle>
<label for=section-903d3e7635db560eef69c6ad03432b92 class="flex justify-between"><a href=/docs/chapter01/>第1章 引言</a></label><ul><li><a href=/docs/chapter01/1-1/>1.1 图形学领域</a></li><li><a href=/docs/chapter01/1-7/>1.7 设计和开发图形程序</a></li></ul></li><li><input type=checkbox id=section-144f7b511d4fbbff231a670ff00b5f9e class=toggle>
<label for=section-144f7b511d4fbbff231a670ff00b5f9e class="flex justify-between"><a href=/docs/chapter02/>第2章 基本数学知识</a></label><ul></ul></li><li><input type=checkbox id=section-fca257306a653a028d58c47b763ab4c5 class=toggle>
<label for=section-fca257306a653a028d58c47b763ab4c5 class="flex justify-between"><a href=/docs/chapter03/>第3章 光栅化图像</a></label><ul><li><a href=/docs/chapter03/3-1/>3.1 光栅化设备</a></li></ul></li><li><input type=checkbox id=section-914c3bbb8c3fc1ae1705d7c0f585a4ae class=toggle>
<label for=section-914c3bbb8c3fc1ae1705d7c0f585a4ae class="flex justify-between"><a href=/docs/chapter04/>第4章 光线追踪</a></label><ul><li><a href=/docs/chapter04/4-1/>4.1 基础光线追踪算法</a></li><li><a href=/docs/chapter04/4-2/>4.2 透视投影</a></li><li><a href=/docs/chapter04/4-3/>4.3 视线的计算</a></li><li><a href=/docs/chapter04/4-4/>4.4 光线对象求交</a></li></ul></li><li class=book-section-flat><a href=/docs/example/>Example Site</a><ul><li><a href=/docs/example/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><input type=checkbox id=section-4e46b01272d410b3a99461d79326ddf4 class=toggle>
<label for=section-4e46b01272d410b3a99461d79326ddf4 class="flex justify-between"><a role=button>Collapsed</a></label><ul><li><a href=/docs/example/collapsed/3rd-level/>3rd Level</a><ul><li><a href=/docs/example/collapsed/3rd-level/4th-level/>4th Level</a></li></ul></li></ul></li></ul></li><li class=book-section-flat><span>Notes</span><ul><li><input type=checkbox id=section-09a42c31eb0974d53fdffb3236ecd72c class=toggle checked>
<label for=section-09a42c31eb0974d53fdffb3236ecd72c class="flex justify-between"><a role=button>Games 101</a></label><ul><li><a href=/docs/notes/games101/rasterization/ class=active>光栅化</a></li><li><a href=/docs/notes/games101/shading/>着色</a></li><li><a href=/docs/notes/games101/ray-tracing/>光线追踪</a></li><li><a href=/docs/notes/games101/path-racing/>路径追踪</a></li></ul></li><li><input type=checkbox id=section-d29b041f99d42b202964e7d69335c343 class=toggle>
<label for=section-d29b041f99d42b202964e7d69335c343 class="flex justify-between"><a role=button>Games 202</a></label><ul></ul></li></ul></li><li class=book-section-flat><span>Shortcodes</span><ul><li><a href=/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/docs/shortcodes/columns/>Columns</a></li><li><a href=/docs/shortcodes/details/>Details</a></li><li><a href=/docs/shortcodes/expand/>Expand</a></li><li><a href=/docs/shortcodes/hints/>Hints</a></li><li><a href=/docs/shortcodes/katex/>Katex</a></li><li><a href=/docs/shortcodes/mermaid/>Mermaid</a></li><li><input type=checkbox id=section-d3fc1bf6d66cd84b896a0af9f40cb1d5 class=toggle>
<label for=section-d3fc1bf6d66cd84b896a0af9f40cb1d5 class="flex justify-between"><a href=/docs/shortcodes/section/>Section</a></label><ul><li><a href=/docs/shortcodes/section/first-page/>First Page</a></li><li><a href=/docs/shortcodes/section/second-page/>Second Page</a></li></ul></li><li><a href=/docs/shortcodes/tabs/>Tabs</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>光栅化</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#离散化三角形>离散化三角形</a><ul><li><a href=#光栅化步骤>光栅化步骤</a></li></ul></li><li><a href=#反走样>反走样</a><ul><li><a href=#走样造成的负面效果>走样造成的负面效果</a></li><li><a href=#反走样的措施>反走样的措施</a></li><li><a href=#模糊处理的方法>模糊处理的方法</a></li><li><a href=#从频域角度分析走样产生的原因>从频域角度分析走样产生的原因</a></li></ul></li><li><a href=#深度缓冲>深度缓冲</a></li></ul></nav></aside></header><article class=markdown><h1 id=光栅化>光栅化
<a class=anchor href=#%e5%85%89%e6%a0%85%e5%8c%96>#</a></h1><p>Rasterization</p><hr><br><h2 id=离散化三角形>离散化三角形
<a class=anchor href=#%e7%a6%bb%e6%95%a3%e5%8c%96%e4%b8%89%e8%a7%92%e5%bd%a2>#</a></h2><p>Triangles</p><hr><ul><li><p>What is a screen?</p><ul><li>An array of pixels</li><li>Size of the array: resolution</li><li>A typical kind of raster display</li></ul></li><li><p>Raster == screen in German（屏幕的德语词汇）</p><ul><li>Rasterize == drawing onto the screen</li></ul></li><li><p>Pixel (FYI, short for “picture element”)</p><ul><li>For now: A pixel is a little square with uniform color</li><li>Color is a mixture of (red, green, blue)</li></ul></li></ul><h3 id=光栅化步骤>光栅化步骤
<a class=anchor href=#%e5%85%89%e6%a0%85%e5%8c%96%e6%ad%a5%e9%aa%a4>#</a></h3><ol><li><p>从变换空间[-1,1]^3^映射到到屏幕空间。首先忽略z方向，使用视口变换将xy空间映射到屏幕。</p><p>视口变换：把[-1,1]^2^变换为[0,width] x [0,height]的屏幕空间。视口变换矩(Viewport transform matrix)阵如下，除以2是因为原空间的宽高都是2，最后一列是平移变换，将原点定义到屏幕中心(否则中心在屏幕左下角)。</p><link rel=stylesheet href=/katex/katex.min.css><script defer src=/katex/katex.min.js></script>
<script defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><span>
\[ M_{viewprot} =
\begin{bmatrix}
{width \over 2}&0&0&{width \over 2}
\\
0&{height \over 2}&0&{width \over 2}
\\
0&0&1&0
\\
0&0&0&1
\end{bmatrix}
\]</span></li><li><p>将3D模型中的三角形片元打散成像素点，以便渲染到屏幕上。</p><p>采样(Sampling)：把一个函数离散化的过程，即将离散的自变量带入函数，获取到离散的值的过程。在光栅化过程中，采样是指用屏幕的像素中心点的位置坐标带入到三角形片元，得到此像素的亮度值和颜色值。</p><p>此步骤的关键是如何判断一个坐标点是否在三角形内部，可以使用叉积判断。假设有三角形ABC和点Q。如果向量AB和向量AQ的叉积大于0，说明Q点在向量AB的左侧（右手定则）。如果BC和BQ，CA和CQ都大于0，说明Q在三角形ABC内部，否则不是。因此Q在三角形ABC内部的充要条件是三个叉积都为正或都为负。</p></li></ol><br><h2 id=反走样>反走样
<a class=anchor href=#%e5%8f%8d%e8%b5%b0%e6%a0%b7>#</a></h2><p>Antialiasing</p><hr><h3 id=走样造成的负面效果>走样造成的负面效果
<a class=anchor href=#%e8%b5%b0%e6%a0%b7%e9%80%a0%e6%88%90%e7%9a%84%e8%b4%9f%e9%9d%a2%e6%95%88%e6%9e%9c>#</a></h3><p>Artifacts due to sampling - “Aliasing”</p><ul><li>Jaggies – sampling in space 锯齿</li><li>Moire – undersampling images 摩尔纹</li><li>Wagon wheel effect – sampling in time 车轮效应</li><li>[Many more] …</li></ul><h3 id=反走样的措施>反走样的措施
<a class=anchor href=#%e5%8f%8d%e8%b5%b0%e6%a0%b7%e7%9a%84%e6%8e%aa%e6%96%bd>#</a></h3><ul><li>增加采样率 &ndash; Increase sampling rate</li><li>在采样之前先做模糊或滤波处理，可以抗锯齿。从频域角度看，先移除高频信号，然后采样。</li><li>Antialiasing By Supersampling (MSAA) &ndash; 在一个像素内部设置多个采样点，用于计算三角形片元覆盖此像素的百分比。此方法本质上是通过更多的采样点来近似模糊操作。</li></ul><h3 id=模糊处理的方法>模糊处理的方法
<a class=anchor href=#%e6%a8%a1%e7%b3%8a%e5%a4%84%e7%90%86%e7%9a%84%e6%96%b9%e6%b3%95>#</a></h3><p>傅里叶变换可以把一个函数从时域变换为频域。从图像角度看，可以将图像的空间坐标信息视为时域空间，从而通过傅里叶变换成频域信息，之后即可进行滤波操作。对于一般拍摄的图片，低频信号携带的信息远远多于高频信号。此处高频信号指图片上变化非常明显的区域，比如深色和浅色的交界处、人像的边界等。滤波分为：高通滤波(滤除低频信号)，低通滤波(滤除高频信号)，带通滤波(只保留中间某个频率范围的信号)。因此，模糊处理属于低通滤波。</p><p>Filtering = Convolution (= Averaging) &ndash; 滤波 == 卷积 (== 平均)</p><p>卷积定理：时域的卷积 == 频域的乘积，时域的乘积 == 频域的卷积</p><p>如下图所示，每个像素都是周围3x3像素范围内取平均值，最终得到一幅模糊图像，此为卷积操作。卷积定理说明，可以先对图像做傅里叶变换，把时域信息变成频域信息，同时可以对3x3的卷积和做傅里叶变换，之后将两者相乘的结果做逆傅里叶变换，最终得到的图像与对图像做卷积操作得到的模糊图像相同。</p><p><img src=/games101/image-20220204013155320.png alt=image-20220204013155320></p><p>其中，3x3的卷积盒成为box filter，此box越大，则傅里叶变换的频域图面积越小，图像越模糊。反之，box越小，频域图面积越大，图像越清晰。</p><h3 id=从频域角度分析走样产生的原因>从频域角度分析走样产生的原因
<a class=anchor href=#%e4%bb%8e%e9%a2%91%e5%9f%9f%e8%a7%92%e5%ba%a6%e5%88%86%e6%9e%90%e8%b5%b0%e6%a0%b7%e4%ba%a7%e7%94%9f%e7%9a%84%e5%8e%9f%e5%9b%a0>#</a></h3><p>Sampling = Repeating Frequency Contents 采样相当于重复频域的内容。</p><p>如下图所示，a图表示一个时域信号函数，b图是此信号函数经过傅里叶变换得到的频域函数。c图是冲击函数，冲击函数和a图的信号函数相乘得到采样结果(e图)。d图是c图冲击函数经过傅里叶变换后得到的频域上的冲击函数。根据卷积定理：==时域上的乘积相当于频域上的卷积==，b卷积d得到图f。从图中可以看出，时域上离散的采样点变成了频域上重复的频域内容。因此，采样就是在重复原始信号的频谱。</p><p><img src=/games101/image-20220204222301707.png alt=image-20220204222301707></p><p>因此，采样率增大导致原始信号的频谱在频域轴上的间隔变小，频谱发生了混叠，从而产生走样现象。</p><p><img src=/games101/image-20220204223739141.png alt=image-20220204223739141></p><p>通过去除高频信号，可以移除低采样率下混叠部分的频谱信息，从而实现反走样。</p><p><img src=/games101/image-20220204224455294.png alt=image-20220204224455294></p><h2 id=深度缓冲>深度缓冲
<a class=anchor href=#%e6%b7%b1%e5%ba%a6%e7%bc%93%e5%86%b2>#</a></h2><p>Z-Buffer</p><hr><p>对几何体近似深度排序存在困难，但是对像素进行深度排序很容易。此方法有 frame buffer 和 depth buffer 两套缓冲系统。frame buffer 用于缓冲颜色信息，depth buffer(z-buffer) 用于缓冲深度信息。如果摄像机离物体越近，其z值越小，反之越大。</p><p>初始深度缓冲值设置为无穷大，在光栅化过程中执行如下算法。此算法时间复杂度为 O(n)。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>for</span> (each triangle T)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (each sample (x,y,z) in T)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (z <span style=color:#f92672>&lt;</span> zbuffer[x,y]) <span style=color:#75715e>// closest sample so far
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        framebuffer[x,y] <span style=color:#f92672>=</span> rgb; <span style=color:#75715e>// update color
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        zbuffer[x,y] <span style=color:#f92672>=</span> z; <span style=color:#75715e>// update depth
</span></span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#离散化三角形>离散化三角形</a><ul><li><a href=#光栅化步骤>光栅化步骤</a></li></ul></li><li><a href=#反走样>反走样</a><ul><li><a href=#走样造成的负面效果>走样造成的负面效果</a></li><li><a href=#反走样的措施>反走样的措施</a></li><li><a href=#模糊处理的方法>模糊处理的方法</a></li><li><a href=#从频域角度分析走样产生的原因>从频域角度分析走样产生的原因</a></li></ul></li><li><a href=#深度缓冲>深度缓冲</a></li></ul></nav></div></aside></main></body></html>